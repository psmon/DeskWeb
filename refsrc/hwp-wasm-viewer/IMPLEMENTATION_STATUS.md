# HWP Viewer 구현 상태

## 현재 구현 완료 사항

### ✅ 완료된 기능

1. **프로젝트 구조**
   - 독립적인 HWP 뷰어 프로젝트로 구성
   - 순수 JavaScript + 외부 라이브러리 사용 (CFB.js, pako)
   - 기술 검증용 POC(Proof of Concept) 프로젝트

2. **CFB 파일 구조 파싱**
   - Compound File Binary (OLE) 구조 읽기
   - 스토리지/스트림 탐색
   - FileHeader, DocInfo, Section 스트림 접근

3. **FileHeader 파싱**
   - 서명 검증 (HWP Document File)
   - 버전 정보 추출 (5.0.x.x)
   - 플래그 비트 분석 (압축, 암호화 등)

4. **PrvText 미리보기 텍스트 파싱** ⭐
   - 압축되지 않은 미리보기 텍스트 추출
   - UTF-16LE 디코딩
   - 대체 렌더링 방식으로 사용

5. **HTML 렌더링**
   - 파싱된 데이터를 HTML로 변환
   - PrvText 대체 렌더링 지원
   - 디버그 정보 출력

6. **UI/UX**
   - 파일 드래그 앤 드롭 지원
   - 모던한 그래디언트 디자인
   - 디버그 출력 영역

## ⚠️ 알려진 제한사항

### 압축 해제 이슈

HWP 5.0 파일의 압축 방식은 **레코드 단위 zlib 압축**을 사용하지만, 현재 구현에서는 압축 해제에 실패하는 경우가 많습니다.

**증상:**
- DocInfo: 예상되는 300+ 레코드 중 1~2개만 파싱됨
- Sections: 레코드는 발견되지만 문단(PARA_TEXT) 추출 실패
- 오류: "레코드 크기가 데이터 범위를 초과"

**원인:**
1. 압축된 레코드의 Size 필드와 실제 압축 데이터 길이 불일치
2. HWP의 특수한 압축 헤더/옵션 미처리
3. 일부 레코드는 압축되지 않을 수 있으나 판별 방법 불명확

**해결 시도:**
- ✅ pako 라이브러리의 inflateRaw, inflate 모두 시도
- ✅ 스트림 단위 압축 해제 → 레코드 단위 압축 해제로 변경
- ✅ 예외 처리로 원본 데이터 사용
- ❌ 여전히 대부분의 레코드 압축 해제 실패

### 현재 대안: PrvText 사용

압축 레코드 파싱 실패 시 **PrvText 스트림**을 대체 렌더링 방식으로 사용합니다.

**PrvText 장점:**
- ✅ 압축되지 않아 바로 읽기 가능
- ✅ UTF-16LE 텍스트로 간단히 디코딩
- ✅ 문서의 주요 텍스트 내용 포함

**PrvText 단점:**
- ❌ 서식 정보 없음 (글꼴, 크기, 색상 등)
- ❌ 표, 그림 등의 구조 정보 없음
- ❌ 레이아웃 정보 없음
- ❌ 일부 HWP 파일은 PrvText가 없을 수 있음

## 📋 향후 개선 방향

### 압축 해제 개선을 위한 연구 필요

1. **HWP 5.0 명세서 상세 분석**
   - 압축 옵션 플래그 확인
   - 레코드별 압축 여부 판별 방법
   - Size 필드의 정확한 의미 (압축 전/후?)

2. **실제 HWP 파일 분석**
   - 다양한 HWP 파일로 테스트
   - 압축 성공/실패 패턴 파악
   - 헥스 에디터로 바이트 단위 검증

3. **대안 라이브러리 검토**
   - 다른 zlib 구현 시도
   - C/C++ zlib을 WebAssembly로 컴파일

4. **기존 오픈소스 참고**
   - hwp.js, node-hwp 등의 구현 연구
   - Python hwp5 라이브러리 로직 참고

## 🎯 기술 검증 결과

### 성공한 부분
- ✅ 브라우저에서 HWP 파일 읽기 가능
- ✅ CFB 구조 파싱 성공
- ✅ FileHeader 완전 파싱
- ✅ PrvText 추출 및 렌더링 성공
- ✅ 기본적인 텍스트 뷰어로 동작

### 추가 연구 필요
- ❌ 복잡한 압축 레코드 파싱
- ❌ 완전한 문단 구조 추출
- ❌ 서식 정보 적용
- ❌ 표, 그림 등 복잡한 구조

## 💡 권장 사항

### 본 프로젝트 통합 시

1. **PrvText 우선 사용**
   - 간단한 텍스트 뷰어로는 충분히 사용 가능
   - 빠른 렌더링 가능

2. **서버 사이드 옵션 고려**
   - Node.js 환경에서 더 강력한 파싱 가능
   - 기존 라이브러리 활용 가능
   - 변환된 HTML/JSON을 클라이언트에 전달

3. **단계적 개선**
   - 1단계: PrvText 기반 간단한 뷰어
   - 2단계: 압축 해제 개선으로 완전한 파싱
   - 3단계: 서식 적용 및 복잡한 구조 렌더링

## 📚 참고 자료

- HWP 5.0 파일 형식 명세서
- CFB.js: https://github.com/SheetJS/js-cfb
- pako: https://github.com/nodeca/pako
- 기존 HWP 파서: hwp.js, node-hwp, hwp5tools

## 결론

현재 구현은 **기본적인 HWP 텍스트 읽기**는 가능하지만, **완전한 HWP 뷰어**로는 부족합니다.

**실용적 사용:**
- ✅ 간단한 문서의 텍스트 내용 확인
- ✅ 기술 검증 및 학습 목적
- ✅ 추가 개발의 기반 코드

**한계:**
- ❌ 복잡한 서식이 있는 문서는 PrvText로만 표시
- ❌ 압축 레코드 파싱 실패로 완전한 구조 추출 불가

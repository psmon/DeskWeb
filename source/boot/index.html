<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <!-- Cache control - force reload on new deployment -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- Setup the viewport for mobile and desktop environments -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />

  <!-- Configure linking of this application to the home screen of mobile devices -->
  <meta name="apple-mobile-web-app-title" content="deskweb"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="msapplication-tap-highlight" content="no"/>
  <link rel="apple-touch-icon" href="${resourcePath}deskweb/app.png"/>
  <link rel="icon" sizes="192x192" href="${resourcePath}deskweb/app.png">

  <!-- Disable chrome translation requests and automatic phone number linking -->
  <meta name="google" value="notranslate"/>
  <meta name="format-detection" content="telephone=no"/>

  <!-- Shortcut icon setup -->
  <link rel="shortcut icon" type="image/png" href="${resourcePath}deskweb/favicon.png"/>
  <link rel="mask-icon" href="${resourcePath}deskweb/favicon.png"/>

  <style>
    body {
      padding: 0px;
      margin: 0px;
      width: 100%;
      height: 100%;
      position: fixed;
      -webkit-touch-callout: none !important;
      overflow: hidden;
    }

    /* Markdown rendering styles - for both Label and Html widgets */
    .qx-label h1, .qx-label h2, .qx-label h3, .qx-label h4, .qx-label h5, .qx-label h6,
    .qx-html h1, .qx-html h2, .qx-html h3, .qx-html h4, .qx-html h5, .qx-html h6 {
      margin-top: 0.5em;
      margin-bottom: 0.5em;
      font-weight: bold;
    }

    .qx-label h1, .qx-html h1 { font-size: 1.5em; }
    .qx-label h2, .qx-html h2 { font-size: 1.3em; }
    .qx-label h3, .qx-html h3 { font-size: 1.1em; }
    .qx-label h4, .qx-label h5, .qx-label h6,
    .qx-html h4, .qx-html h5, .qx-html h6 { font-size: 1em; }

    .qx-label p, .qx-html p {
      margin: 0.5em 0;
    }

    .qx-label pre, .qx-html pre {
      background-color: #f6f8fa;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 8px 12px;
      overflow-x: auto;
      margin: 0.5em 0;
    }

    .qx-label code, .qx-html code {
      background-color: #f6f8fa;
      border-radius: 3px;
      padding: 2px 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .qx-label pre code, .qx-html pre code {
      background-color: transparent;
      border: none;
      padding: 0;
    }

    .qx-label ul, .qx-label ol,
    .qx-html ul, .qx-html ol {
      margin: 0.5em 0;
      padding-left: 2em;
    }

    .qx-label li, .qx-html li {
      margin: 0.2em 0;
    }

    .qx-label blockquote, .qx-html blockquote {
      border-left: 4px solid #d0d7de;
      padding-left: 1em;
      margin: 0.5em 0;
      color: #57606a;
    }

    .qx-label table, .qx-html table {
      border-collapse: collapse;
      margin: 0.5em 0;
      width: 100%;
    }

    .qx-label th, .qx-label td,
    .qx-html th, .qx-html td {
      border: 1px solid #d0d7de;
      padding: 6px 13px;
    }

    .qx-label th, .qx-html th {
      background-color: #f6f8fa;
      font-weight: bold;
    }

    .qx-label a, .qx-html a {
      color: #0969da;
      text-decoration: none;
    }

    .qx-label a:hover, .qx-html a:hover {
      text-decoration: underline;
    }

    .qx-label hr, .qx-html hr {
      border: none;
      border-top: 1px solid #d0d7de;
      margin: 1em 0;
    }

    /* Mermaid diagram styles */
    .qx-label .mermaid, .qx-html .mermaid {
      background-color: white;
      padding: 10px;
      border-radius: 6px;
      margin: 0.5em 0;
      text-align: center;
    }

    /* Enable text selection in HTML widgets */
    .qx-html {
      user-select: text;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
    }
  </style>

  <title>deskweb</title>
  <noscript>
    <meta http-equiv="refresh" content="0; url=nojs.html"/>
  </noscript>

  <!-- Markdown rendering libraries -->
  <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/lib/marked.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
  <script>
    // Initialize Mermaid
    if (typeof mermaid !== 'undefined') {
      mermaid.initialize({
        startOnLoad: false,
        theme: 'default',
        securityLevel: 'loose'
      });
    }
  </script>

  <!-- HWP.js library placeholder -->
  <script>
    // Temporary placeholder for hwp.js until proper browser bundle is created
    // The actual hwp.js requires a proper build process for browser compatibility
    window.hwpjs = {
      Viewer: function(container, data) {
        console.log('[HWP] Placeholder Viewer initialized');
        console.log('[HWP] Container:', container);
        console.log('[HWP] Data size:', data ? data.length : 0);

        // Create a placeholder UI with scrollable content
        container.innerHTML = `
          <div style="padding: 40px; background: white; border: 2px dashed #ccc; border-radius: 8px; text-align: center; min-height: 1200px;">
            <h2 style="color: #0078d4; margin-bottom: 20px;">HWP 뷰어</h2>
            <div style="background: #f0f0f0; padding: 30px; border-radius: 6px; margin: 20px 0;">
              <p style="font-size: 16px; color: #333; margin: 10px 0;">
                <strong>파일 정보:</strong>
              </p>
              <p style="color: #666; margin: 5px 0;">
                파일 크기: ${data ? Math.round(data.length / 1024) + ' KB' : '알 수 없음'}
              </p>
              <p style="color: #666; margin: 5px 0;">
                형식: HWP (한글 워드프로세서)
              </p>
            </div>
            <div style="background: #e8f4f8; padding: 20px; border-left: 4px solid #0078d4; margin: 20px 0; text-align: left;">
              <p style="margin: 5px 0; color: #333;"><strong>안내:</strong></p>
              <p style="margin: 5px 0; color: #555;">HWP 파일이 성공적으로 로드되었습니다.</p>
              <p style="margin: 5px 0; color: #555;">실제 HWP 문서 렌더링을 위해서는 hwp.js 브라우저 번들이 필요합니다.</p>
            </div>
            <div style="margin-top: 30px; padding: 20px; background: white; border: 1px solid #ddd; text-align: left;">
              <h3 style="color: #0078d4; margin-bottom: 15px;">구현된 기능:</h3>
              <ul style="color: #555; line-height: 1.8; list-style-position: inside;">
                <li>✅ HWP 파일 열기 (파일 선택 대화상자)</li>
                <li>✅ 가상 파일 시스템에서 HWP 파일 로드</li>
                <li>✅ 확대/축소 기능</li>
                <li>✅ 페이지 탐색 기능</li>
                <li>✅ 인쇄 기능</li>
                <li>✅ 드래그 앤 드롭 지원</li>
                <li>✅ 스크롤 기능</li>
                <li>⏳ HWP 문서 렌더링 (hwp.js 브라우저 번들 필요)</li>
              </ul>
            </div>
            <div style="margin-top: 30px; padding: 30px; background: #f9f9f9; border: 1px solid #ddd; text-align: left;">
              <h3 style="color: #0078d4; margin-bottom: 15px;">문서 내용 미리보기</h3>
              <p style="color: #555; line-height: 1.8; margin: 10px 0;">
                이곳에는 실제 HWP 문서의 내용이 표시됩니다.
              </p>
              <p style="color: #555; line-height: 1.8; margin: 10px 0;">
                hwp.js 라이브러리가 통합되면 한글 워드프로세서 문서의 텍스트, 이미지, 표,
                그리고 다양한 서식이 원본 그대로 렌더링됩니다.
              </p>
              <div style="background: white; padding: 20px; margin: 20px 0; border-left: 3px solid #0078d4;">
                <h4 style="color: #333; margin: 10px 0;">스크롤 테스트 영역</h4>
                <p style="color: #666; line-height: 1.6;">
                  이 영역은 스크롤 기능을 테스트하기 위한 공간입니다.
                  창의 크기를 조절하거나 확대/축소 기능을 사용하여
                  스크롤바가 정상적으로 작동하는지 확인하실 수 있습니다.
                </p>
                ${Array(10).fill(0).map((_, i) => `
                  <p style="color: #888; line-height: 1.6; margin: 10px 0;">
                    ${i + 1}. 스크롤 테스트 라인입니다.
                    이 텍스트는 스크롤 기능이 정상적으로 작동하는지 확인하기 위한 것입니다.
                    창의 높이보다 컨텐츠가 길 경우 스크롤바가 나타나야 합니다.
                  </p>
                `).join('')}
              </div>
            </div>
            <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; text-align: left;">
              <h4 style="color: #856404; margin: 10px 0;">향후 개선 사항</h4>
              <ul style="color: #856404; line-height: 1.8;">
                <li>실제 HWP 문서 렌더링</li>
                <li>텍스트 검색 기능</li>
                <li>북마크 기능</li>
                <li>주석 추가 기능</li>
                <li>PDF 변환 기능</li>
              </ul>
            </div>
          </div>
        `;

        return this;
      }
    };

    console.log('[HWP] Placeholder library initialized');
  </script>

  ${preBootJs}

  <!-- Service Worker Registration for cache management -->
  <script>
    // Register Service Worker for cache busting
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('${resourcePath}deskweb/sw.js?v=' + Date.now())
          .then(function(registration) {
            console.log('[App] ServiceWorker registered:', registration.scope);

            // Check for updates every 60 seconds
            setInterval(function() {
              registration.update();
            }, 60000);

            // Listen for updates
            registration.addEventListener('updatefound', function() {
              const newWorker = registration.installing;
              console.log('[App] ServiceWorker update found');

              newWorker.addEventListener('statechange', function() {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  console.log('[App] New ServiceWorker installed, reloading page...');

                  // Notify user and reload
                  if (confirm('A new version is available. Reload to update?')) {
                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                    window.location.reload();
                  }
                }
              });
            });
          })
          .catch(function(error) {
            console.log('[App] ServiceWorker registration failed:', error);
          });

        // Handle controller change (new service worker activated)
        navigator.serviceWorker.addEventListener('controllerchange', function() {
          console.log('[App] ServiceWorker controller changed, reloading...');
          window.location.reload();
        });
      });
    }

    // Add timestamp to prevent cache
    (function() {
      var timestamp = new Date().getTime();
      console.log('[App] Loading with timestamp:', timestamp);

      // Store version info
      window.DESKWEB_VERSION = timestamp;
    })();
  </script>

  <script type="text/javascript" src="${appPath}index.js?v=${timestamp}"></script>

 </head>
<body>
</body>
</html>
